import{r as o,j as s}from"./react-CFvbW3tR.js";import{m as D,c as A,b as G,n as M,D as _,z as B,E as f,F as T}from"./codicent-app-sdk-DXRVzLEb.js";import{u as z}from"./react-router-dom-DAwTWwZD.js";import{l as N,m as O}from"./index-DeBjKzBM.js";import{c as H,s as K}from"./@griffel-B6ADR5Kd.js";import{t as V}from"./@fluentui-hGxI4ynz.js";import{u as W}from"./react-router-C-4Ov6ZN.js";import"./@braintree-DY5JYOZd.js";import"./@mermaid-js-U5IBypfp.js";import"./langium-CdARkFFN.js";import"./vscode-jsonrpc-ByHGxxVC.js";import"./vscode-languageserver-types-NoPvPymt.js";import"./chevrotain-D1YjmfcG.js";import"./@chevrotain-D6nI8fqk.js";import"./lodash-es-DC2U6FIr.js";import"./chevrotain-allstar-DEMvE_-m.js";import"./vscode-uri-D3CQYEzw.js";import"./vscode-languageserver-textdocument-CKBVUiR3.js";import"./react-dom-o8OcDbuK.js";import"./@remix-run-Df5FVpDT.js";import"./mermaid-C_HjE0iy.js";import"./ts-dedent-DrFu-skq.js";import"./d3-transition-Dh49aRff.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-CfLzPKWk.js";import"./d3-color-amxIadob.js";import"./d3-selection-Bj1BqfTz.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-zoom-BjlmSQgB.js";import"./dompurify-BlFzGd2J.js";import"./stylis-Bmj7FPPA.js";import"./dagre-d3-es-3reODgjt.js";import"./khroma-DUX6PT6k.js";import"./dayjs-B-NUFg1t.js";import"./d3-scale-C6sbQl2n.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DGRYoJHh.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-DgsO5LpX.js";import"./d3-time-BF7_rz0X.js";import"./d3-axis-DSWTncID.js";import"./d3-shape-L3Itesln.js";import"./d3-path-CimkQT29.js";import"./roughjs-GtHDBO_d.js";import"./cytoscape-BlEmlE64.js";import"./cytoscape-cose-bilkent-NPpav9ZH.js";import"./cose-base-B9X2GT9R.js";import"./layout-base-85SqnYhL.js";import"./d3-sankey-CgO6js3K.js";import"./d3-scale-chromatic-CvOaoHrI.js";import"./@iconify-D2F_yRRF.js";import"./marked-DK8KC6kv.js";import"./cytoscape-fcose-V_63gsaN.js";import"./@auth0-DpSad-xP.js";import"./rtl-css-js-DzRCw-ju.js";import"./@emotion-WldOFDRm.js";import"./react-is-D0tnNtx9.js";import"./keyborg-DWQCxiIY.js";const Y=H({main:{flexGrow:1,...K.padding("10px"),overflowY:"auto"},container:{maxWidth:"640px",margin:"0 auto",backgroundPosition:"calc(50% + 100px) center",backgroundRepeat:"no-repeat",backgroundSize:"contain",height:"100%"},root:{height:"100%"},item:{height:"auto",width:"auto",flexShrink:1,marginBottom:"1rem"},chat:{flexGrow:1,boxSizing:"border-box",overflow:"hidden",border:"none"},attachmentBar:{display:"none"},iconButton:{width:"24px",height:"24px"},imageCard:{alignContent:"center",borderRadius:V.borderRadiusLarge,height:"240px",textAlign:"left",position:"relative"}}),to=({state:F})=>{const v=Y(),{t:e}=D(),[R,C]=o.useState(!1),h=o.useRef(null),x=o.useRef(null),S=o.useRef(null),[m,U]=o.useState(null),[c,d]=o.useState([]),{service:i}=F,[r,I]=z(),[j,g]=o.useState(void 0),[b,P]=o.useState(),p=A(),y=W(),n=o.useCallback(t=>{for(const a of t)i.getFileInfo(a).then(l=>{d(L=>[...L,l])})},[i,d]),E=o.useCallback(t=>{const a=new FormData;a.append("file",t),i.uploadFile(t.name,a).then(l=>{n([l])}).catch(()=>{p.notify(e("Error"),e("Error uploading pasted image"),"")})},[i,n,p,e]),u=t=>{C(t)};o.useEffect(()=>{const t=r.get("text"),a=r.get("url"),l=r.get("parentId");t&&(g(t),r.delete("text")),l&&(P(l),r.delete("parentId")),a&&(r.delete("url"),g(((t||"")+" "+a).trim())),I(r,{replace:!0})},[r,I,g,i,n]);const $=async()=>{console.log("attach-location");const t=await T();t?(p.notify(e("Position"),e("Position tillagd."),""),U(`#gps(${t.coords.latitude},${t.coords.longitude})`)):console.log("Failed to get GPS location")},k=()=>{U(null),p.notify(e("Position"),e("Position borttagen."),""),console.log("clear-location")},w=t=>{t=`${t}${m?" "+m:""}${c.length>0?`
`:""}${c.map(a=>`#file:${a.id}`).join(" ")}`,i.sendMessage(t,b).then(()=>{p.notify(e("Meddelande"),e("Meddelandet Ã¤r sparat."),""),b&&(P(void 0),y(-1))})};return s.jsx(G,{hideHeader:!0,children:s.jsxs("div",{className:v.container,style:{backgroundImage:`url(${N})`},children:[s.jsx(M,{title:e(O)}),s.jsx(_,{disableSend:!0,defaultText:j,onSend:w,files:c,onFilesChange:d,isUploading:R,onHandleDefaultFiles:n,onUploadFile:()=>{var t;(t=h.current)==null||t.triggerUpload(),console.log("attach-file")},onUploadImage:()=>{var t;(t=x.current)==null||t.triggerUpload(),console.log("attach-image")},onUploadCamera:()=>{var t;(t=S.current)==null||t.triggerUpload(),console.log("attach-camera")},getImageUrl:B.getImageUrl,onLocationChange:t=>{t?$():k()},hasLocation:!!m,onImagePasted:E}),s.jsx(f,{ref:h,onFileUploaded:n,onUploading:u,multiple:!0,codicentService:i}),s.jsx(f,{codicentService:i,ref:x,onFileUploaded:n,onUploading:u,multiple:!0,accept:"image/*"}),s.jsx(f,{codicentService:i,ref:S,onFileUploaded:n,onUploading:u,multiple:!0,accept:"image/*",capture:"environment"})]})})};export{to as Compose,to as default};
