import{a as n,p as c,m as P,i as w,b as I,f as D,s as B,c as W,e as M}from"./lodash-es-DC2U6FIr.js";function s(t){return t.charCodeAt(0)}function b(t,e){Array.isArray(t)?t.forEach(function(i){e.push(i)}):e.push(t)}function f(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function h(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function _(){throw Error("Internal Error - Should never get here!")}function T(t){return t.type==="Character"}const A=[];for(let t=s("0");t<=s("9");t++)A.push(t);const k=[s("_")].concat(A);for(let t=s("a");t<=s("z");t++)k.push(t);for(let t=s("A");t<=s("Z");t++)k.push(t);const L=[s(" "),s("\f"),s(`
`),s("\r"),s("	"),s("\v"),s("	"),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s(" "),s("\u2028"),s("\u2029"),s(" "),s(" "),s("　"),s("\uFEFF")],O=/[0-9a-fA-F]/,x=/[0-9]/,G=/[1-9]/;class j{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const i=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":f(r,"global");break;case"i":f(r,"ignoreCase");break;case"m":f(r,"multiLine");break;case"u":f(r,"unicode");break;case"y":f(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:i,loc:this.loc(0)}}disjunction(){const e=[],i=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(i)}}alternative(){const e=[],i=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(i)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let i;switch(this.popChar()){case"=":i="Lookahead";break;case"!":i="NegativeLookahead";break}h(i);const r=this.disjunction();return this.consumeChar(")"),{type:i,value:r,loc:this.loc(e)}}return _()}quantifier(e=!1){let i;const r=this.idx;switch(this.popChar()){case"*":i={atLeast:0,atMost:1/0};break;case"+":i={atLeast:1,atMost:1/0};break;case"?":i={atLeast:0,atMost:1};break;case"{":const a=this.integerIncludingZero();switch(this.popChar()){case"}":i={atLeast:a,atMost:a};break;case",":let l;this.isDigit()?(l=this.integerIncludingZero(),i={atLeast:a,atMost:l}):i={atLeast:a,atMost:1/0},this.consumeChar("}");break}if(e===!0&&i===void 0)return;h(i);break}if(!(e===!0&&i===void 0)&&h(i))return this.peekChar(0)==="?"?(this.consumeChar("?"),i.greedy=!1):i.greedy=!0,i.type="Quantifier",i.loc=this.loc(r),i}atom(){let e;const i=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),h(e))return e.loc=this.loc(i),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[s(`
`),s("\r"),s("\u2028"),s("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,i=!1;switch(this.popChar()){case"d":e=A;break;case"D":e=A,i=!0;break;case"s":e=L;break;case"S":e=L,i=!0;break;case"w":e=k;break;case"W":e=k,i=!0;break}if(h(e))return{type:"Set",value:e,complement:i}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=s("\f");break;case"n":e=s(`
`);break;case"r":e=s("\r");break;case"t":e=s("	");break;case"v":e=s("\v");break}if(h(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:s("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:s(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:s(e)}}}characterClass(){const e=[];let i=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),i=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,T(r)&&this.isRangeDash()){this.consumeChar("-");const a=this.classAtom();if(a.type,T(a)){if(a.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:a.value})}else b(r.value,e),e.push(s("-")),b(a.value,e)}else b(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:i,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:s("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const i=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:i};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(G.test(e)===!1)throw Error("Expecting a positive integer");for(;x.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(x.test(e)===!1)throw Error("Expecting an integer");for(;x.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:s(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return x.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let i="";for(let a=0;a<e;a++){const l=this.popChar();if(O.test(l)===!1)throw Error("Expecting a HexDecimal digits");i+=l}return{type:"Character",value:parseInt(i,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class z{visitChildren(e){for(const i in e){const r=e[i];e.hasOwnProperty(i)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(a=>{this.visit(a)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}function H(t){console&&console.error&&console.error(`Error: ${t}`)}function Q(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function Z(t){const e=new Date().getTime(),i=t();return{time:new Date().getTime()-e,value:i}}function $(t){function e(){}e.prototype=t;const i=new e;function r(){return typeof i.bar}return r(),r(),t}function q(t){return F(t)?t.LABEL:t.name}function F(t){return w(t.LABEL)&&t.LABEL!==""}class o{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),D(this.definition,i=>{i.accept(e)})}}class p extends o{constructor(e){super([]),this.idx=1,n(this,c(e,i=>i!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class R extends o{constructor(e){super(e.definition),this.orgText="",n(this,c(e,i=>i!==void 0))}}class S extends o{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,n(this,c(e,i=>i!==void 0))}}class d extends o{constructor(e){super(e.definition),this.idx=1,n(this,c(e,i=>i!==void 0))}}class E extends o{constructor(e){super(e.definition),this.idx=1,n(this,c(e,i=>i!==void 0))}}class y extends o{constructor(e){super(e.definition),this.idx=1,n(this,c(e,i=>i!==void 0))}}class m extends o{constructor(e){super(e.definition),this.idx=1,n(this,c(e,i=>i!==void 0))}}class C extends o{constructor(e){super(e.definition),this.idx=1,n(this,c(e,i=>i!==void 0))}}class v extends o{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,n(this,c(e,i=>i!==void 0))}}class u{constructor(e){this.idx=1,n(this,c(e,i=>i!==void 0))}accept(e){e.visit(this)}}function Y(t){return P(t,g)}function g(t){function e(i){return P(i,g)}if(t instanceof p){const i={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return w(t.label)&&(i.label=t.label),i}else{if(t instanceof S)return{type:"Alternative",definition:e(t.definition)};if(t instanceof d)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof E)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof y)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:g(new u({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof C)return{type:"RepetitionWithSeparator",idx:t.idx,separator:g(new u({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof m)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof v)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof u){const i={type:"Terminal",name:t.terminalType.name,label:q(t.terminalType),idx:t.idx};w(t.label)&&(i.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(i.pattern=I(r)?r.source:r),i}else{if(t instanceof R)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class X{visit(e){const i=e;switch(i.constructor){case p:return this.visitNonTerminal(i);case S:return this.visitAlternative(i);case d:return this.visitOption(i);case E:return this.visitRepetitionMandatory(i);case y:return this.visitRepetitionMandatoryWithSeparator(i);case C:return this.visitRepetitionWithSeparator(i);case m:return this.visitRepetition(i);case v:return this.visitAlternation(i);case u:return this.visitTerminal(i);case R:return this.visitRule(i);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function J(t){return t instanceof S||t instanceof d||t instanceof m||t instanceof E||t instanceof y||t instanceof C||t instanceof u||t instanceof R}function N(t,e=[]){return t instanceof d||t instanceof m||t instanceof C?!0:t instanceof v?B(t.definition,r=>N(r,e)):t instanceof p&&W(e,t)?!1:t instanceof o?(t instanceof p&&e.push(t),M(t.definition,r=>N(r,e))):!1}function V(t){return t instanceof v}function K(t){if(t instanceof p)return"SUBRULE";if(t instanceof d)return"OPTION";if(t instanceof v)return"OR";if(t instanceof E)return"AT_LEAST_ONE";if(t instanceof y)return"AT_LEAST_ONE_SEP";if(t instanceof C)return"MANY_SEP";if(t instanceof m)return"MANY";if(t instanceof u)return"CONSUME";throw Error("non exhaustive match")}export{S as A,z as B,X as G,p as N,d as O,Q as P,E as R,u as T,y as a,C as b,m as c,v as d,V as e,N as f,j as g,H as h,J as i,$ as j,K as k,R as l,Y as s,Z as t};
