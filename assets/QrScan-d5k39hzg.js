import{r as o,j as t}from"./react-CFvbW3tR.js";import{H as C}from"./index-DeBjKzBM.js";import{u as S}from"./react-router-dom-DAwTWwZD.js";import{m as w,b as R,n as A}from"./codicent-app-sdk-DXRVzLEb.js";import{j as M}from"./jsqr-CIAR7AOj.js";import{c as k}from"./@griffel-B6ADR5Kd.js";import{u as O}from"./react-router-C-4Ov6ZN.js";import{M as B,a as I,b as N,c as D,B as E}from"./@fluentui-hGxI4ynz.js";import"./@braintree-DY5JYOZd.js";import"./react-dom-o8OcDbuK.js";import"./@mermaid-js-U5IBypfp.js";import"./langium-CdARkFFN.js";import"./vscode-jsonrpc-ByHGxxVC.js";import"./vscode-languageserver-types-NoPvPymt.js";import"./chevrotain-D1YjmfcG.js";import"./@chevrotain-D6nI8fqk.js";import"./lodash-es-DC2U6FIr.js";import"./chevrotain-allstar-DEMvE_-m.js";import"./vscode-uri-D3CQYEzw.js";import"./vscode-languageserver-textdocument-CKBVUiR3.js";import"./mermaid-C_HjE0iy.js";import"./ts-dedent-DrFu-skq.js";import"./d3-transition-Dh49aRff.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-CfLzPKWk.js";import"./d3-color-amxIadob.js";import"./d3-selection-Bj1BqfTz.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-zoom-BjlmSQgB.js";import"./dompurify-BlFzGd2J.js";import"./stylis-Bmj7FPPA.js";import"./dagre-d3-es-3reODgjt.js";import"./khroma-DUX6PT6k.js";import"./dayjs-B-NUFg1t.js";import"./d3-scale-C6sbQl2n.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DGRYoJHh.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-DgsO5LpX.js";import"./d3-time-BF7_rz0X.js";import"./d3-axis-DSWTncID.js";import"./d3-shape-L3Itesln.js";import"./d3-path-CimkQT29.js";import"./roughjs-GtHDBO_d.js";import"./cytoscape-BlEmlE64.js";import"./cytoscape-cose-bilkent-NPpav9ZH.js";import"./cose-base-B9X2GT9R.js";import"./layout-base-85SqnYhL.js";import"./d3-sankey-CgO6js3K.js";import"./d3-scale-chromatic-CvOaoHrI.js";import"./@iconify-D2F_yRRF.js";import"./marked-DK8KC6kv.js";import"./cytoscape-fcose-V_63gsaN.js";import"./@auth0-DpSad-xP.js";import"./@remix-run-Df5FVpDT.js";import"./rtl-css-js-DzRCw-ju.js";import"./@emotion-WldOFDRm.js";import"./react-is-D0tnNtx9.js";import"./keyborg-DWQCxiIY.js";const F=k({container:{overflow:"hidden",width:"var(--qr-scanner-width)",height:"var(--qr-scanner-height)"},video:{width:"100%",height:"100%",objectFit:"cover"},canvas:{display:"none"}}),$=({onScan:d,onError:u,width:m=300,height:n=300,facingMode:g="environment",className:h})=>{const r=o.useRef(null),p=o.useRef(null),[c,b]=o.useState(null),f=F(),x=o.useCallback(async()=>{c&&(console.log("Stopping previous stream:",c),c.getTracks().forEach(e=>e.stop()));const s={video:{facingMode:g,width:{ideal:m},height:{ideal:n}},audio:!1};try{const e=await navigator.mediaDevices.getUserMedia(s);console.log("MediaStream obtained:",e),b(a=>a!==e?e:a),r.current&&r.current.srcObject!==e&&(r.current.srcObject=e,console.log("Video element srcObject set:",r.current.srcObject),r.current.onloadedmetadata=()=>{var a;(a=r.current)==null||a.play().then(()=>{console.log("Video is playing")}).catch(l=>{console.error("Error playing video:",l)})})}catch(e){console.error("Error accessing camera:",e),u==null||u(e instanceof Error?e.message:"Failed to access camera")}},[g,n,u,m]);return o.useEffect(()=>(x(),()=>{c&&(console.log("Cleaning up stream:",c),c.getTracks().forEach(s=>s.stop()))}),[x]),o.useEffect(()=>{if(!r.current||!p.current)return;const s=r.current,e=p.current,a=e.getContext("2d");if(!a)return;let l;const y=()=>{if(s.readyState===s.HAVE_ENOUGH_DATA){e.width=s.videoWidth,e.height=s.videoHeight,a.drawImage(s,0,0,e.width,e.height);const v=a.getImageData(0,0,e.width,e.height),i=M(v.data,v.width,v.height);i&&(d==null||d(i.data))}l=requestAnimationFrame(y)};return y(),()=>{cancelAnimationFrame(l)}},[d]),t.jsxs("div",{className:`${f.container} ${h||""}`,style:{"--qr-scanner-width":typeof m=="number"?`${m}px`:m,"--qr-scanner-height":typeof n=="number"?`${n}px`:n},children:[t.jsx("video",{ref:r,className:f.video,playsInline:!0}),t.jsx("canvas",{ref:p,className:f.canvas})]})},H=k({container:{backgroundImage:"url('"+C+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",height:"100%",touchAction:"pan-y",margin:"0 auto",maxWidth:"800px",display:"flex",flexDirection:"column",alignItems:"center"},flashOverlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"transparent",transition:"background-color 0.2s ease-out",pointerEvents:"none",zIndex:3},scannerContainer:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,width:"100%"}}),Ve=({state:d,title:u,singleShot:m})=>{const n=H(),{service:g}=d,{t:h}=w(),[r,p]=o.useState(),c=o.useMemo(()=>new Audio("/audio/camera.mp3"),[]),[b,f]=o.useState(!1),[x,s]=o.useState(!1),e=O(),[a]=S(),l=a.get("tags"),y=o.useCallback(async i=>{s(!0),console.log("Scanned result:",i),c.play(),f(!0),setTimeout(()=>f(!1),100),setTimeout(()=>s(!1),1e3);try{await g.sendMessage(`${l?l+" ":""}${i}`),m===!0&&e(-1)}catch(j){console.error("Error sending message:",j),p(j instanceof Error?j.message:String(j))}},[c,g,l,m,e]),v=o.useCallback(i=>{console.log("QR Scanner Error:",i),p(i)},[]);return t.jsx(R,{hideHeader:!0,children:t.jsxs("div",{className:n.container,children:[t.jsx("div",{className:n.flashOverlay,style:{backgroundColor:b?"#ffffff":"transparent"}}),r&&t.jsxs(B,{intent:"error",children:[t.jsxs(I,{children:[t.jsx(N,{children:h("Fel")}),r]}),t.jsx(D,{containerAction:t.jsx(E,{appearance:"transparent",icon:"DismissRegular"}),children:t.jsx(E,{onClick:()=>p(void 0),children:h("OK")})})]}),t.jsx(A,{title:u||h("Skanna")}),t.jsx("div",{className:n.scannerContainer,children:t.jsx($,{onScan:i=>{x||y(i)},onError:v})})]})})};export{Ve as default};
