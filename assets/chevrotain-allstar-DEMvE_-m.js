import{L as at,g as j,t as ct,a as ft}from"./chevrotain-D1YjmfcG.js";import{T as H,N as V,d as w,O as P,c as I,b as C,R as $,a as B}from"./@chevrotain-D6nI8fqk.js";import{x as lt,m as A,t as z,f as N,g as ut,w as dt,K as ht,H as pt,L as gt}from"./lodash-es-DC2U6FIr.js";function R(t,e,n){return`${t.name}_${e}_${n}`}const k=1,St=2,J=4,Q=5,_=7,Tt=8,yt=9,At=10,kt=11,X=12;class D{constructor(e){this.target=e}isEpsilon(){return!1}}class U extends D{constructor(e,n){super(e),this.tokenType=n}}class Z extends D{constructor(e){super(e)}isEpsilon(){return!0}}class F extends D{constructor(e,n,s){super(e),this.rule=n,this.followState=s}isEpsilon(){return!0}}function mt(t){const e={decisionMap:{},decisionStates:[],ruleToStartState:new Map,ruleToStopState:new Map,states:[]};Lt(e,t);const n=t.length;for(let s=0;s<n;s++){const i=t[s],o=L(e,i,i);o!==void 0&&Pt(e,i,o)}return e}function Lt(t,e){const n=e.length;for(let s=0;s<n;s++){const i=e[s],o=h(t,i,void 0,{type:St}),a=h(t,i,void 0,{type:_});o.stop=a,t.ruleToStartState.set(i,o),t.ruleToStopState.set(i,a)}}function tt(t,e,n){return n instanceof H?K(t,e,n.terminalType,n):n instanceof V?wt(t,e,n):n instanceof w?Ot(t,e,n):n instanceof P?bt(t,e,n):n instanceof I?xt(t,e,n):n instanceof C?Rt(t,e,n):n instanceof $?Et(t,e,n):n instanceof B?_t(t,e,n):L(t,e,n)}function xt(t,e,n){const s=h(t,e,n,{type:Q});m(t,s);const i=E(t,e,s,n,L(t,e,n));return nt(t,e,n,i)}function Rt(t,e,n){const s=h(t,e,n,{type:Q});m(t,s);const i=E(t,e,s,n,L(t,e,n)),o=K(t,e,n.separator,n);return nt(t,e,n,i,o)}function Et(t,e,n){const s=h(t,e,n,{type:J});m(t,s);const i=E(t,e,s,n,L(t,e,n));return et(t,e,n,i)}function _t(t,e,n){const s=h(t,e,n,{type:J});m(t,s);const i=E(t,e,s,n,L(t,e,n)),o=K(t,e,n.separator,n);return et(t,e,n,i,o)}function Ot(t,e,n){const s=h(t,e,n,{type:k});m(t,s);const i=A(n.definition,a=>tt(t,e,a));return E(t,e,s,n,...i)}function bt(t,e,n){const s=h(t,e,n,{type:k});m(t,s);const i=E(t,e,s,n,L(t,e,n));return Nt(t,e,n,i)}function L(t,e,n){const s=lt(A(n.definition,i=>tt(t,e,i)),i=>i!==void 0);return s.length===1?s[0]:s.length===0?void 0:vt(t,s)}function et(t,e,n,s,i){const o=s.left,a=s.right,r=h(t,e,n,{type:kt});m(t,r);const c=h(t,e,n,{type:X});return o.loopback=r,c.loopback=r,t.decisionMap[R(e,i?"RepetitionMandatoryWithSeparator":"RepetitionMandatory",n.idx)]=r,d(a,r),i===void 0?(d(r,o),d(r,c)):(d(r,c),d(r,i.left),d(i.right,o)),{left:o,right:c}}function nt(t,e,n,s,i){const o=s.left,a=s.right,r=h(t,e,n,{type:At});m(t,r);const c=h(t,e,n,{type:X}),f=h(t,e,n,{type:yt});return r.loopback=f,c.loopback=f,d(r,o),d(r,c),d(a,f),i!==void 0?(d(f,c),d(f,i.left),d(i.right,o)):d(f,r),t.decisionMap[R(e,i?"RepetitionWithSeparator":"Repetition",n.idx)]=r,{left:r,right:c}}function Nt(t,e,n,s){const i=s.left,o=s.right;return d(i,o),t.decisionMap[R(e,"Option",n.idx)]=i,s}function m(t,e){return t.decisionStates.push(e),e.decision=t.decisionStates.length-1,e.decision}function E(t,e,n,s,...i){const o=h(t,e,s,{type:Tt,start:n});n.end=o;for(const r of i)r!==void 0?(d(n,r.left),d(r.right,o)):d(n,o);const a={left:n,right:o};return t.decisionMap[R(e,Mt(s),s.idx)]=n,a}function Mt(t){if(t instanceof w)return"Alternation";if(t instanceof P)return"Option";if(t instanceof I)return"Repetition";if(t instanceof C)return"RepetitionWithSeparator";if(t instanceof $)return"RepetitionMandatory";if(t instanceof B)return"RepetitionMandatoryWithSeparator";throw new Error("Invalid production type encountered")}function vt(t,e){const n=e.length;for(let o=0;o<n-1;o++){const a=e[o];let r;a.left.transitions.length===1&&(r=a.left.transitions[0]);const c=r instanceof F,f=r,S=e[o+1].left;a.left.type===k&&a.right.type===k&&r!==void 0&&(c&&f.followState===a.right||r.target===a.right)?(c?f.followState=S:r.target=S,It(t,a.right)):d(a.right,S)}const s=e[0],i=e[n-1];return{left:s.left,right:i.right}}function K(t,e,n,s){const i=h(t,e,s,{type:k}),o=h(t,e,s,{type:k});return W(i,new U(o,n)),{left:i,right:o}}function wt(t,e,n){const s=n.referencedRule,i=t.ruleToStartState.get(s),o=h(t,e,n,{type:k}),a=h(t,e,n,{type:k}),r=new F(i,s,a);return W(o,r),{left:o,right:a}}function Pt(t,e,n){const s=t.ruleToStartState.get(e);d(s,n.left);const i=t.ruleToStopState.get(e);return d(n.right,i),{left:s,right:i}}function d(t,e){const n=new Z(e);W(t,n)}function h(t,e,n,s){const i=Object.assign({atn:t,production:n,epsilonOnlyTransitions:!1,rule:e,transitions:[],nextTokenWithinRule:[],stateNumber:t.states.length},s);return t.states.push(i),i}function W(t,e){t.transitions.length===0&&(t.epsilonOnlyTransitions=e.isEpsilon()),t.transitions.push(e)}function It(t,e){t.states.splice(t.states.indexOf(e),1)}const O={};class v{constructor(){this.map={},this.configs=[]}get size(){return this.configs.length}finalize(){this.map={}}add(e){const n=st(e);n in this.map||(this.map[n]=this.configs.length,this.configs.push(e))}get elements(){return this.configs}get alts(){return A(this.configs,e=>e.alt)}get key(){let e="";for(const n in this.map)e+=n+":";return e}}function st(t,e=!0){return`${e?`a${t.alt}`:""}s${t.state.stateNumber}:${t.stack.map(n=>n.stateNumber.toString()).join("_")}`}function Ct(t,e){const n={};return s=>{const i=s.toString();let o=n[i];return o!==void 0||(o={atnStartState:t,decision:e,states:{}},n[i]=o),o}}class it{constructor(){this.predicates=[]}is(e){return e>=this.predicates.length||this.predicates[e]}set(e,n){this.predicates[e]=n}toString(){let e="";const n=this.predicates.length;for(let s=0;s<n;s++)e+=this.predicates[s]===!0?"1":"0";return e}}const q=new it;class ie extends at{constructor(e){var n;super(),this.logging=(n=e==null?void 0:e.logging)!==null&&n!==void 0?n:s=>console.log(s)}initialize(e){this.atn=mt(e.rules),this.dfas=$t(this.atn)}validateAmbiguousAlternationAlternatives(){return[]}validateEmptyOrAlternatives(){return[]}buildLookaheadForAlternation(e){const{prodOccurrence:n,rule:s,hasPredicates:i,dynamicTokensEnabled:o}=e,a=this.dfas,r=this.logging,c=R(s,"Alternation",n),S=this.atn.decisionMap[c].decision,x=A(j({maxLookahead:1,occurrence:n,prodType:"Alternation",rule:s}),l=>A(l,u=>u[0]));if(Y(x,!1)&&!o){const l=z(x,(u,T,g)=>(N(T,p=>{p&&(u[p.tokenTypeIdx]=g,N(p.categoryMatches,y=>{u[y]=g}))}),u),{});return i?function(u){var T;const g=this.LA(1),p=l[g.tokenTypeIdx];if(u!==void 0&&p!==void 0){const y=(T=u[p])===null||T===void 0?void 0:T.GATE;if(y!==void 0&&y.call(this)===!1)return}return p}:function(){const u=this.LA(1);return l[u.tokenTypeIdx]}}else return i?function(l){const u=new it,T=l===void 0?0:l.length;for(let p=0;p<T;p++){const y=l==null?void 0:l[p].GATE;u.set(p,y===void 0||y.call(this))}const g=M.call(this,a,S,u,r);return typeof g=="number"?g:void 0}:function(){const l=M.call(this,a,S,q,r);return typeof l=="number"?l:void 0}}buildLookaheadForOptional(e){const{prodOccurrence:n,rule:s,prodType:i,dynamicTokensEnabled:o}=e,a=this.dfas,r=this.logging,c=R(s,i,n),S=this.atn.decisionMap[c].decision,x=A(j({maxLookahead:1,occurrence:n,prodType:i,rule:s}),l=>A(l,u=>u[0]));if(Y(x)&&x[0][0]&&!o){const l=x[0],u=ut(l);if(u.length===1&&dt(u[0].categoryMatches)){const g=u[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===g}}else{const T=z(u,(g,p)=>(p!==void 0&&(g[p.tokenTypeIdx]=!0,N(p.categoryMatches,y=>{g[y]=!0})),g),{});return function(){const g=this.LA(1);return T[g.tokenTypeIdx]===!0}}}return function(){const l=M.call(this,a,S,q,r);return typeof l=="object"?!1:l===0}}}function Y(t,e=!0){const n=new Set;for(const s of t){const i=new Set;for(const o of s){if(o===void 0){if(e)break;return!1}const a=[o.tokenTypeIdx].concat(o.categoryMatches);for(const r of a)if(n.has(r)){if(!i.has(r))return!1}else n.add(r),i.add(r)}}return!0}function $t(t){const e=t.decisionStates.length,n=Array(e);for(let s=0;s<e;s++)n[s]=Ct(t.decisionStates[s],s);return n}function M(t,e,n,s){const i=t[e](n);let o=i.start;if(o===void 0){const r=Gt(i.atnStartState);o=rt(i,ot(r)),i.start=o}return Bt.apply(this,[i,o,n,s])}function Bt(t,e,n,s){let i=e,o=1;const a=[];let r=this.LA(o++);for(;;){let c=jt(i,r);if(c===void 0&&(c=Dt.apply(this,[t,i,r,o,n,s])),c===O)return Wt(a,i,r);if(c.isAcceptState===!0)return c.prediction;i=c,a.push(r),r=this.LA(o++)}}function Dt(t,e,n,s,i,o){const a=zt(e.configs,n,i);if(a.size===0)return G(t,e,n,O),O;let r=ot(a);const c=Yt(a,i);if(c!==void 0)r.isAcceptState=!0,r.prediction=c,r.configs.uniqueAlt=c;else if(Qt(a)){const f=ht(a.alts);r.isAcceptState=!0,r.prediction=f,r.configs.uniqueAlt=f,Ut.apply(this,[t,s,a.alts,o])}return r=G(t,e,n,r),r}function Ut(t,e,n,s){const i=[];for(let f=1;f<=e;f++)i.push(this.LA(f).tokenType);const o=t.atnStartState,a=o.rule,r=o.production,c=Ft({topLevelRule:a,ambiguityIndices:n,production:r,prefixPath:i});s(c)}function Ft(t){const e=A(t.prefixPath,i=>ct(i)).join(", "),n=t.production.idx===0?"":t.production.idx;let s=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(", ")}> in <${Kt(t.production)}${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return s=s+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,s}function Kt(t){if(t instanceof V)return"SUBRULE";if(t instanceof P)return"OPTION";if(t instanceof w)return"OR";if(t instanceof $)return"AT_LEAST_ONE";if(t instanceof B)return"AT_LEAST_ONE_SEP";if(t instanceof C)return"MANY_SEP";if(t instanceof I)return"MANY";if(t instanceof H)return"CONSUME";throw Error("non exhaustive match")}function Wt(t,e,n){const s=pt(e.configs.elements,o=>o.state.transitions),i=gt(s.filter(o=>o instanceof U).map(o=>o.tokenType),o=>o.tokenTypeIdx);return{actualToken:n,possibleTokenTypes:i,tokenPath:t}}function jt(t,e){return t.edges[e.tokenTypeIdx]}function zt(t,e,n){const s=new v,i=[];for(const a of t.elements){if(n.is(a.alt)===!1)continue;if(a.state.type===_){i.push(a);continue}const r=a.state.transitions.length;for(let c=0;c<r;c++){const f=a.state.transitions[c],S=qt(f,e);S!==void 0&&s.add({state:S,alt:a.alt,stack:a.stack})}}let o;if(i.length===0&&s.size===1&&(o=s),o===void 0){o=new v;for(const a of s.elements)b(a,o)}if(i.length>0&&!Vt(o))for(const a of i)o.add(a);return o}function qt(t,e){if(t instanceof U&&ft(e,t.tokenType))return t.target}function Yt(t,e){let n;for(const s of t.elements)if(e.is(s.alt)===!0){if(n===void 0)n=s.alt;else if(n!==s.alt)return}return n}function ot(t){return{configs:t,edges:{},isAcceptState:!1,prediction:-1}}function G(t,e,n,s){return s=rt(t,s),e.edges[n.tokenTypeIdx]=s,s}function rt(t,e){if(e===O)return e;const n=e.configs.key,s=t.states[n];return s!==void 0?s:(e.configs.finalize(),t.states[n]=e,e)}function Gt(t){const e=new v,n=t.transitions.length;for(let s=0;s<n;s++){const o={state:t.transitions[s].target,alt:s,stack:[]};b(o,e)}return e}function b(t,e){const n=t.state;if(n.type===_){if(t.stack.length>0){const i=[...t.stack],a={state:i.pop(),alt:t.alt,stack:i};b(a,e)}else e.add(t);return}n.epsilonOnlyTransitions||e.add(t);const s=n.transitions.length;for(let i=0;i<s;i++){const o=n.transitions[i],a=Ht(t,o);a!==void 0&&b(a,e)}}function Ht(t,e){if(e instanceof Z)return{state:e.target,alt:t.alt,stack:t.stack};if(e instanceof F){const n=[...t.stack,e.followState];return{state:e.target,alt:t.alt,stack:n}}}function Vt(t){for(const e of t.elements)if(e.state.type===_)return!0;return!1}function Jt(t){for(const e of t.elements)if(e.state.type!==_)return!1;return!0}function Qt(t){if(Jt(t))return!0;const e=Xt(t.elements);return Zt(e)&&!te(e)}function Xt(t){const e=new Map;for(const n of t){const s=st(n,!1);let i=e.get(s);i===void 0&&(i={},e.set(s,i)),i[n.alt]=!0}return e}function Zt(t){for(const e of Array.from(t.values()))if(Object.keys(e).length>1)return!0;return!1}function te(t){for(const e of Array.from(t.values()))if(Object.keys(e).length===1)return!0;return!1}export{ie as L};
