import{r as t,j as o}from"./react-CFvbW3tR.js";import{u as B}from"./react-router-dom-DAwTWwZD.js";import{m as H,v as W,r as z,w as G,b as Y,n as K,x as L,y as q,_ as J,z as Q,A as X,C as Z}from"./codicent-app-sdk-DXRVzLEb.js";import{C as ee,h as te}from"./index-DeBjKzBM.js";import{c as oe}from"./@griffel-B6ADR5Kd.js";import"./@braintree-DY5JYOZd.js";import"./react-dom-o8OcDbuK.js";import"./react-router-C-4Ov6ZN.js";import"./@remix-run-Df5FVpDT.js";import"./@mermaid-js-U5IBypfp.js";import"./langium-CdARkFFN.js";import"./vscode-jsonrpc-ByHGxxVC.js";import"./vscode-languageserver-types-NoPvPymt.js";import"./chevrotain-D1YjmfcG.js";import"./@chevrotain-D6nI8fqk.js";import"./lodash-es-DC2U6FIr.js";import"./chevrotain-allstar-DEMvE_-m.js";import"./vscode-uri-D3CQYEzw.js";import"./vscode-languageserver-textdocument-CKBVUiR3.js";import"./mermaid-C_HjE0iy.js";import"./ts-dedent-DrFu-skq.js";import"./d3-transition-Dh49aRff.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-CfLzPKWk.js";import"./d3-color-amxIadob.js";import"./d3-selection-Bj1BqfTz.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-zoom-BjlmSQgB.js";import"./dompurify-BlFzGd2J.js";import"./stylis-Bmj7FPPA.js";import"./dagre-d3-es-3reODgjt.js";import"./khroma-DUX6PT6k.js";import"./dayjs-B-NUFg1t.js";import"./d3-scale-C6sbQl2n.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DGRYoJHh.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-DgsO5LpX.js";import"./d3-time-BF7_rz0X.js";import"./d3-axis-DSWTncID.js";import"./d3-shape-L3Itesln.js";import"./d3-path-CimkQT29.js";import"./roughjs-GtHDBO_d.js";import"./cytoscape-BlEmlE64.js";import"./cytoscape-cose-bilkent-NPpav9ZH.js";import"./cose-base-B9X2GT9R.js";import"./layout-base-85SqnYhL.js";import"./d3-sankey-CgO6js3K.js";import"./d3-scale-chromatic-CvOaoHrI.js";import"./@iconify-D2F_yRRF.js";import"./marked-DK8KC6kv.js";import"./cytoscape-fcose-V_63gsaN.js";import"./@auth0-DpSad-xP.js";import"./@fluentui-hGxI4ynz.js";import"./react-is-D0tnNtx9.js";import"./keyborg-DWQCxiIY.js";import"./rtl-css-js-DzRCw-ju.js";import"./@emotion-WldOFDRm.js";const se=oe({chatContainer:{width:"100%",flex:1,maxWidth:"800px",height:"100%",display:"flex",flexDirection:"column",margin:"0 auto",overflow:"hidden","@media (max-width: 768px)":{maxWidth:"100%",borderRadius:"0"},"@media (max-width: 480px)":{},backgroundPosition:"calc(50%) center",backgroundRepeat:"no-repeat",backgroundSize:"contain",touchAction:"pan-y"},chatMessages:{display:"flex",flexDirection:"column",flex:1,padding:"16px",overflowY:"auto",touchAction:"pan-y"}}),ct=({state:r})=>{const T=se(),{t:i}=H(),{messages:a,isBotTyping:l,handleSend:u,newChat:x,openChat:R}=W(r.stateMachine),w=t.useRef(null),[p,F]=B(),[g,n]=t.useState(null),[V,S]=t.useState(!1),{service:c}=r,[m,d]=t.useState([]),[h,f]=t.useState([]),[b,C]=t.useState(!1),[j,_]=t.useState(),[re,k]=z(r.context.selectedApp+"_prompts",[]),{extractTemplateVariables:D,replaceTemplateVariables:v,extractFilePlaceholders:M,replaceFilePlaceholders:y,handleSelectFiles:O}=G(c.uploadFile),A=t.useRef(!1),U=()=>{var e;(e=w.current)==null||e.scrollIntoView({behavior:"smooth"})};t.useEffect(()=>{},[r.service,k,a.length]),t.useEffect(()=>{setTimeout(()=>U(),10)},[a]),t.useEffect(()=>{if(A.current)return;A.current=!0;const e=p.get("text"),s=p.get("id"),P=p.get("fid");e?(async()=>{const E=M(e),N=D(e);x(),(E.length>0||N.length>0)&&(f(E),d(N),C(!0)),n(i(e))})():s?R(s):P&&(_(P),c.getFormById(P).then(I=>{x(),n(I.prompt)}))},[]),t.useEffect(()=>{if(g&&!b){let e=g;h.length>0&&(e=y(e,h)),m.length>0&&(e=v(e,m)),u(e),F({},{replace:!0}),n(null),d([]),f([])}},[g,b,u,F,y,v,h,m]);const $=e=>{const s=p.get("append");s&&(e+=`
---
`+s),u(e)};return o.jsxs(Y,{hideHeader:!0,hideFooter:!!j,children:[o.jsxs("div",{id:"chat-container",className:T.chatContainer,style:{backgroundImage:`url(${ee})`},children:[o.jsx(K,{title:i("Chatt"),onNewChat:j?void 0:()=>S(!0)}),o.jsxs("div",{className:T.chatMessages,children:[te,a.map((e,s)=>o.jsxs("div",{children:[(l&&s===a.length-1||!l&&s===a.length-2)&&o.jsx("div",{ref:w}),o.jsx(L,{sender:e.sender,content:e.content,isNew:e.isNew},e.id)]},e.id)),l&&o.jsx(q,{})]}),o.jsx(J,{codicent:r.context.selectedApp,disableSend:l,onSend:$,onSelectFiles:O,getImageUrl:Q.getImageUrl,getFileInfo:e=>c.getFileInfo(e)})]}),o.jsx(X,{open:V,title:i("Vill du rensa chatten?"),content:i("En ny startas, men chatten kommer fÃ¶rst sparas."),onYes:()=>{S(!1),x()},onNo:()=>S(!1)}),o.jsx(Z,{open:b,templateVariables:m,filePlaceholders:h,onTemplateVariablesChange:d,onFilePlaceholdersChange:f,onConfirm:()=>C(!1),onCancel:()=>{C(!1),n(null),d([]),f([])},uploadFile:c.uploadFile})]})};export{ct as default};
