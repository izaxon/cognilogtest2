import{r as o,j as a}from"./react-CFvbW3tR.js";import{r as q,m as y,b as A,n as C,q as P,t as b,I as _,u as N}from"./codicent-app-sdk-DXRVzLEb.js";import{u as $}from"./react-router-dom-DAwTWwZD.js";import{P as k,L as v,g as F}from"./index-DeBjKzBM.js";import{c as D}from"./@griffel-B6ADR5Kd.js";import{u as G}from"./react-router-C-4Ov6ZN.js";import"./@braintree-DY5JYOZd.js";import"./@mermaid-js-U5IBypfp.js";import"./langium-CdARkFFN.js";import"./vscode-jsonrpc-ByHGxxVC.js";import"./vscode-languageserver-types-NoPvPymt.js";import"./chevrotain-D1YjmfcG.js";import"./@chevrotain-D6nI8fqk.js";import"./lodash-es-DC2U6FIr.js";import"./chevrotain-allstar-DEMvE_-m.js";import"./vscode-uri-D3CQYEzw.js";import"./vscode-languageserver-textdocument-CKBVUiR3.js";import"./react-dom-o8OcDbuK.js";import"./@remix-run-Df5FVpDT.js";import"./mermaid-C_HjE0iy.js";import"./ts-dedent-DrFu-skq.js";import"./d3-transition-Dh49aRff.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-CfLzPKWk.js";import"./d3-color-amxIadob.js";import"./d3-selection-Bj1BqfTz.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-zoom-BjlmSQgB.js";import"./dompurify-BlFzGd2J.js";import"./stylis-Bmj7FPPA.js";import"./dagre-d3-es-3reODgjt.js";import"./khroma-DUX6PT6k.js";import"./dayjs-B-NUFg1t.js";import"./d3-scale-C6sbQl2n.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-DGRYoJHh.js";import"./d3-format-CzD4bSOQ.js";import"./d3-time-format-DgsO5LpX.js";import"./d3-time-BF7_rz0X.js";import"./d3-axis-DSWTncID.js";import"./d3-shape-L3Itesln.js";import"./d3-path-CimkQT29.js";import"./roughjs-GtHDBO_d.js";import"./cytoscape-BlEmlE64.js";import"./cytoscape-cose-bilkent-NPpav9ZH.js";import"./cose-base-B9X2GT9R.js";import"./layout-base-85SqnYhL.js";import"./d3-sankey-CgO6js3K.js";import"./d3-scale-chromatic-CvOaoHrI.js";import"./@iconify-D2F_yRRF.js";import"./marked-DK8KC6kv.js";import"./cytoscape-fcose-V_63gsaN.js";import"./@auth0-DpSad-xP.js";import"./@fluentui-hGxI4ynz.js";import"./react-is-D0tnNtx9.js";import"./keyborg-DWQCxiIY.js";import"./rtl-css-js-DzRCw-ju.js";import"./@emotion-WldOFDRm.js";const B=D({container:{width:"100%",flex:1,maxWidth:"800px",height:"100%",backgroundColor:"#ffffff",display:"flex",flexDirection:"column",margin:"0 auto",overflow:"hidden","@media (max-width: 768px)":{maxWidth:"100%",borderRadius:"0"},"@media (max-width: 480px)":{},touchAction:"pan-y",paddingLeft:"10px",paddingRight:"10px"},search_results:{overflowY:"auto",height:"calc(100vh - 200px)",marginTop:"10px"}}),He=({state:I})=>{const[u,E]=$(),[i,f]=o.useState(u.get("q")||""),{service:d}=I,{selectedApp:n}=I.context,[l,T]=q(`messages-${n}`,[]),[R,g]=o.useState(!1),p=o.useRef(null),c=o.useRef(null),h=o.useRef(!0),L=B(),x=o.useRef(null),{t:S}=y(),O=G(),j=e=>{f(e)};return o.useEffect(()=>{const e=u.get("q")||"";f(e)},[u]),o.useEffect(()=>{let e=!0;return p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{if(i===void 0){f("");return}E(i?{q:i}:{},{replace:!0});const r=F.split(",");g(!0),console.log("log-search: "+(i||"-")),d.getMessagesFast(r,void 0,100,k).then(m=>{if(!e){g(!1);return}const t=m.filter(s=>s.content.toLowerCase().includes(i.toLowerCase()));(t.length===0||l.length===0||t[0].id!==l[0].id)&&T(t)}).catch(m=>{console.warn(m)}).finally(()=>g(!1))},500),()=>{e=!1,p.current&&clearTimeout(p.current)}},[i,d,T,E]),o.useEffect(()=>{const e=c.current;if(!e)return;const r=()=>{requestAnimationFrame(()=>{sessionStorage.setItem("log-scroll-pos-"+n,e.scrollTop.toString())})};return e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)},[]),o.useEffect(()=>{if(!h.current)return;const e=sessionStorage.getItem("log-scroll-pos-"+n);e&&c.current&&requestAnimationFrame(()=>{c.current&&(c.current.scrollTop=parseInt(e))}),h.current=!1},[l,n]),o.useEffect(()=>{h.current||c.current&&(c.current.scrollTop=0,sessionStorage.removeItem("log-scroll-pos-"+n))},[i,n]),o.useEffect(()=>{const e=c.current;return e?(x.current=new ResizeObserver(()=>{const t=sessionStorage.getItem(`log-scroll-pos-${n}`);t&&(e.scrollTop=parseInt(t))}),e.querySelectorAll(".message-item").forEach(t=>{var s;(s=x.current)==null||s.observe(t)}),e.querySelectorAll("img").forEach(t=>{if(!t.complete){const s=e.scrollTop;t.addEventListener("load",()=>{e.scrollTop=s},{once:!0})}}),()=>{var t;(t=x.current)==null||t.disconnect()}):void 0},[l,n]),a.jsx(A,{hideHeader:!0,children:a.jsxs("div",{className:L.container,children:[a.jsx(C,{title:S("Loggbok")}),a.jsx(P,{placeholder:S("Sök")+"...",value:i,onChange:j}),a.jsxs("div",{className:L.search_results,ref:c,children:[R&&a.jsx("p",{children:S("Söker")+"..."}),l.map(e=>{var s,w;const r=new b(e.content),m=v?((s=v[r.tags[0]])==null?void 0:s.name)||r.tags[0]||(r.files.length>0?(w=v.file)==null?void 0:w.name:""):r.tags[0],t=r.content;return a.jsx(_,{id:e.id,header:m,description:"",timestamp:N(new Date(e.createdAt)),text:t,tags:r.tags,image:"",fileIds:r.files,codicentService:d,onEdit:()=>{O(`/new/?text=${encodeURIComponent(e.content)}&parentId=${e.id}`)}},e.id)})]})]})})};export{He as Log,He as default};
