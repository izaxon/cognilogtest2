var l={},u={};Object.defineProperty(u,"__esModule",{value:!0});let f;function _(){if(f===void 0)throw new Error("No runtime abstraction layer installed");return f}(function(e){function t(n){if(n===void 0)throw new Error("No runtime abstraction layer provided");f=n}e.install=t})(_||(_={}));u.default=_;var i={};Object.defineProperty(i,"__esModule",{value:!0});i.stringArray=i.array=i.func=i.error=i.number=i.string=i.boolean=void 0;function E(e){return e===!0||e===!1}i.boolean=E;function p(e){return typeof e=="string"||e instanceof String}i.string=p;function g(e){return typeof e=="number"||e instanceof Number}i.number=g;function w(e){return e instanceof Error}i.error=w;function A(e){return typeof e=="function"}i.func=A;function v(e){return Array.isArray(e)}i.array=v;function R(e){return v(e)&&e.every(t=>p(t))}i.stringArray=R;var a={};Object.defineProperty(a,"__esModule",{value:!0});a.Emitter=a.Event=void 0;const x=u;var b;(function(e){const t={dispose(){}};e.None=function(){return t}})(b||(a.Event=b={}));class N{add(t,n=null,s){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(t),this._contexts.push(n),Array.isArray(s)&&s.push({dispose:()=>this.remove(t,n)})}remove(t,n=null){if(!this._callbacks)return;let s=!1;for(let r=0,o=this._callbacks.length;r<o;r++)if(this._callbacks[r]===t)if(this._contexts[r]===n){this._callbacks.splice(r,1),this._contexts.splice(r,1);return}else s=!0;if(s)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...t){if(!this._callbacks)return[];const n=[],s=this._callbacks.slice(0),r=this._contexts.slice(0);for(let o=0,y=s.length;o<y;o++)try{n.push(s[o].apply(r[o],t))}catch(C){(0,x.default)().console.error(C)}return n}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}}class h{constructor(t){this._options=t}get event(){return this._event||(this._event=(t,n,s)=>{this._callbacks||(this._callbacks=new N),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(t,n);const r={dispose:()=>{this._callbacks&&(this._callbacks.remove(t,n),r.dispose=h._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(s)&&s.push(r),r}),this._event}fire(t){this._callbacks&&this._callbacks.invoke.call(this._callbacks,t)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}a.Emitter=h;h._noop=function(){};var m;Object.defineProperty(l,"__esModule",{value:!0});var q=l.CancellationTokenSource=m=l.CancellationToken=void 0;const L=u,j=i,d=a;var c;(function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:d.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:d.Event.None});function t(n){const s=n;return s&&(s===e.None||s===e.Cancelled||j.boolean(s.isCancellationRequested)&&!!s.onCancellationRequested)}e.is=t})(c||(m=l.CancellationToken=c={}));const O=Object.freeze(function(e,t){const n=(0,L.default)().timer.setTimeout(e.bind(t),0);return{dispose(){n.dispose()}}});class k{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?O:(this._emitter||(this._emitter=new d.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}class T{get token(){return this._token||(this._token=new k),this._token}cancel(){this._token?this._token.cancel():this._token=c.Cancelled}dispose(){this._token?this._token instanceof k&&this._token.dispose():this._token=c.None}}q=l.CancellationTokenSource=T;export{m as C,q as a};
